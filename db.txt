start mysql in ubuntu
$ service mysql start

CREATE SCHEMA `url_shortner` ;


User
+ id
+ username
+ password (hash)
+ name
+ create_date
+ is_active

urls
+ id
+ set_url
+ go_to_url
+ creation_date
+ user_id



=====

CREATE TABLE `url_shortner`.`user` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(255) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  `user_type` VARCHAR(45) NULL,
  `create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`));


CREATE TABLE `url_shortner`.`url_links` (
  `url_id` INT NOT NULL,
  `actual_url` VARCHAR(255) NOT NULL,
  `go_to_url` VARCHAR(255) NOT NULL,
  `user_id` INT NOT NULL,
  `create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`url_id`),
  UNIQUE INDEX `actual_url_UNIQUE` (`actual_url` ASC),
  INDEX `fk_url_links_1_idx` (`user_id` ASC),
  CONSTRAINT `fk_url_links_1`
    FOREIGN KEY (`user_id`)
    REFERENCES `url_shortner`.`user` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);


CREATE TABLE `url_shortner`.`log_access_url` (
  `log_id` INT NOT NULL AUTO_INCREMENT,
  `url_id` INT NOT NULL,
  `create_date` TIMESTAMP(0) NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`log_id`),
  INDEX `fk_log_access_url_1_idx` (`url_id` ASC),
  CONSTRAINT `fk_log_access_url_1`
    FOREIGN KEY (`url_id`)
    REFERENCES `url_shortner`.`url_links` (`url_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);



npm install bcrypt jsonwebtoken knex mysql pg passport passport-jwt


{
    "name": "TypeError",
    "message": "app.db is not a function",
    "stack": "TypeError: app.db is not a function\n

=>>>>> at Object.getAll (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/src/services/url.js:14:16)\n
    at /home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/src/controller/url.js:8:22\n
   at Layer.handle [as handle_request] (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/layer.js:95:5)\n
at next (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/route.js:137:13)\n
at Route.dispatch (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/route.js:112:3)\n
at Layer.handle [as handle_request] (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/layer.js:95:5)\n
at /home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/index.js:281:22\n
at Function.process_params (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/index.js:335:12)\n
    at next (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/index.js:275:10)\n
    at Function.handle (/home/rhavel/Documentos/DEPLOY-PROJECTS/url-shortner/url-shortner-back/node_modules/express/lib/router/index.js:174:3)"
}

{
        "actual_url": "ronan",
        "go_to_url": "http://youtube.com",
        "user_id": 1,
}



==========

DEFALUT TIME SATAMP

eXEMPLO DE TABELA

CREATE TABLE t1 (
  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  dt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

Para modificar no workbeacnh, use o botao direito na variavel TIMESTMAP que vai ter as opções default boas



============


PK: PRIMARY KEY

NN: NOT NULL

UQ: UNIQUE INDEX

BIN: BINARY

UN: UNSIGNED

ZF: ZEROFILL

AI: AUTO_INCREMENT

G: Generated Column


===


============== Ultimos retoques

+ Testar Cadastro de usuário [x]
+ Testar funcionalidades
+ Validar entradasr (URL, Email) e Limitar username [x]
+ Criar Seed e Migration com Knex e saber executar [x]
+ Testse unitários com JEST para a API
+ Cypress no front-end

===========

executar knex de pasta interna


node_modules/.bin/knex --knexfile /usr/local/etc/xxx/knexfile.js --cwd . migrate:currentVersion

FUNCIONA ESSE

"migrate": "yarn knex migrate:latest --knexfile src/config/knexfile.js",

 knex seed:make seed_name

npx knex seed:make seed_user --knexfile src/db/knexfile.js
